"use strict";(self.webpackChunkcarbide_docs=self.webpackChunkcarbide_docs||[]).push([[3129],{1884:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>o,toc:()=>l});var t=r(4848),s=r(8453);const a={},i="Prerequisites",o={id:"IC-cloud-support-docs/prereqs",title:"Prerequisites",description:"In order to utilize IC Cloud Support with Rancher Government, you will need the following prerequisites.",source:"@site/docs/IC-cloud-support-docs/prereqs.md",sourceDirName:"IC-cloud-support-docs",slug:"/IC-cloud-support-docs/prereqs",permalink:"/carbide-docs/docs/IC-cloud-support-docs/prereqs",draft:!1,unlisted:!1,editUrl:"https://github.com/rancherfederal/carbide-docs/edit/main/docs/IC-cloud-support-docs/prereqs.md",tags:[],version:"current",frontMatter:{},sidebar:"carbideSidebar",previous:{title:"Introduction",permalink:"/carbide-docs/docs/IC-cloud-support-docs/introduction"},next:{title:"Installation",permalink:"/carbide-docs/docs/IC-cloud-support-docs/installation"}},c={},l=[{value:"Tools",id:"tools",level:2},{value:"IAM Role &amp; Instance Profile",id:"iam-role--instance-profile",level:2},{value:"Rancher Manager Configurations",id:"rancher-manager-configurations",level:2},{value:"Helm Values",id:"helm-values",level:3},{value:"Custom CA Certificate Secret",id:"custom-ca-certificate-secret",level:3},{value:"Registry Configuration",id:"registry-configuration",level:3}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"prerequisites",children:"Prerequisites"})}),"\n",(0,t.jsx)(n.p,{children:"In order to utilize IC Cloud Support with Rancher Government, you will need the following prerequisites."}),"\n",(0,t.jsx)(n.h2,{id:"tools",children:"Tools"}),"\n",(0,t.jsx)(n.p,{children:"The following tools are required to install/upgrade Rancher Government."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://rancherfederal.github.io/hauler-docs/docs/introduction/install",children:"Hauler"}),", or Docker"]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://helm.sh/docs/intro/install",children:"Helm"})}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://ranchermanager.docs.rancher.com/getting-started/installation-and-upgrade",children:"Rancher Government"})," (v2.10.3, v2.9.7, v2.8.13 or greater)"]}),"\n"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"NOTE:"})," This feature is only availabe in the Rancher Government product. Carbide customers can download the required artifacts from the ",(0,t.jsx)(n.a,{href:"https://portal.ranchercarbide.dev/",children:"Carbide Portal"})," or the ",(0,t.jsx)(n.a,{href:"/carbide-docs/docs/registry-docs/downloading-images",children:"Carbide Secured Regsitry"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Rancher Government Portal",src:r(5592).A+"",width:"1786",height:"997"})}),"\n",(0,t.jsx)(n.h2,{id:"iam-role--instance-profile",children:"IAM Role & Instance Profile"}),"\n",(0,t.jsxs)(n.p,{children:["The Amazon EC2 provisioner requires a certain amount of access to read, write, and delete some AWS resources. Enabling these sans principal credentials (i.e. access key and secret key) requires an ",(0,t.jsx)(n.a,{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html#ec2-instance-profile",children:"EC2 Instance Profile"}),", associated with an IAM Role, for each node in the Rancher management cluster, with the following policy:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n    "Version": "2012-10-17",\n    "Statement": [\n        {\n            "Sid": "RancherAWSEC2Permissions",\n            "Effect": "Allow",\n            "Action": [\n                "ec2:AuthorizeSecurityGroupIngress",\n                "ec2:Describe*",\n                "ec2:ImportKeyPair",\n                "ec2:CreateKeyPair",\n                "ec2:CreateSecurityGroup",\n                "ec2:CreateTags",\n                "ec2:DeleteKeyPair",\n                "ec2:ModifyInstanceMetadataOptions"\n            ],\n            "Resource": "*"\n        },\n        {\n            "Sid": "RancherAWSKMSPermissions",\n            "Effect": "Allow",\n            "Action": [\n                "kms:Decrypt",\n                "kms:GenerateDataKeyWithoutPlaintext",\n                "kms:Encrypt",\n                "kms:DescribeKey",\n                "kms:CreateGrant",\n                "ec2:DetachVolume",\n                "ec2:AttachVolume",\n                "ec2:DeleteSnapshot",\n                "ec2:DeleteTags",\n                "ec2:CreateTags",\n                "ec2:CreateVolume",\n                "ec2:DeleteVolume",\n                "ec2:CreateSnapshot"\n            ],\n            "Resource": [\n              "arn:aws:ec2:AWS_REGION_PLACEHOLDER:AWS_ACCOUNT_ID_PLACEHOLDER:volume/*",\n              "arn:aws:ec2:AWS_REGION_PLACEHOLDER:AWS_ACCOUNT_ID_PLACEHOLDER:instance/*",\n              "arn:aws:ec2:AWS_REGION_PLACEHOLDER\':AWS_ACCOUNT_ID_PLACEHOLDER:snapshot/*",\n              "arn:aws:kms:AWS_REGION_PLACEHOLDER\':AWS_ACCOUNT_ID_PLACEHOLDER:key/*"\n            ]\n        },\n        {\n            "Sid": "RancherAWSPassRolePermissions",\n            "Effect": "Allow",\n            "Action": [\n\t\t\t\t"iam:PassRole",\n\t\t\t\t"ec2:RunInstances",\n\t\t\t\t"ec2:DetachVolume",\n\t\t\t\t"ec2:AttachVolume",\n\t\t\t\t"ec2:DeleteSnapshot",\n\t\t\t\t"ec2:DeleteTags",\n\t\t\t\t"ec2:CreateTags",\n\t\t\t\t"ec2:CreateVolume",\n\t\t\t\t"ec2:DeleteVolume",\n\t\t\t\t"ec2:CreateSnapshot"\n            ],\n            "Resource": [\n                "arn:aws:ec2:AWS_REGION_PLACEHOLDER::image/ami-*",\n                "arn:aws:ec2:AWS_REGION_PLACEHOLDER:AWS_ACCOUNT_ID_PLACEHOLDER:instance/*",\n                "arn:aws:ec2:AWS_REGION_PLACEHOLDER:AWS_ACCOUNT_ID_PLACEHOLDER:placement-group/*",\n                "arn:aws:ec2:AWS_REGION_PLACEHOLDER:AWS_ACCOUNT_ID_PLACEHOLDER:volume/*",\n                "arn:aws:ec2:AWS_REGION_PLACEHOLDER:AWS_ACCOUNT_ID_PLACEHOLDER:subnet/*",\n                "arn:aws:ec2:AWS_REGION_PLACEHOLDER:AWS_ACCOUNT_ID_PLACEHOLDER:key-pair/*",\n                "arn:aws:ec2:AWS_REGION_PLACEHOLDER:AWS_ACCOUNT_ID_PLACEHOLDER:network-interface/*",\n                "arn:aws:ec2:AWS_REGION_PLACEHOLDER:AWS_ACCOUNT_ID_PLACEHOLDER:security-group/*",\n                "arn:aws:iam::AWS_ACCOUNT_ID_PLACEHOLDER:role/*"\n            ]\n        },\n        {\n            "Sid": "RancherAWSEC2ScopedPermissions",\n            "Effect": "Allow",\n            "Action": [\n                "ec2:RebootInstances",\n                "ec2:TerminateInstances",\n                "ec2:StartInstances",\n                "ec2:StopInstances"\n            ],\n            "Resource": "arn:aws:ec2:AWS_REGION_PLACEHOLDER:AWS_ACCOUNT_ID_PLACEHOLDER:instance/*"\n        }\n    ]\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Modify IAM Role",src:r(5244).A+"",width:"1658",height:"674"})}),"\n",(0,t.jsx)(n.h2,{id:"rancher-manager-configurations",children:"Rancher Manager Configurations"}),"\n",(0,t.jsx)(n.p,{children:"Rancher Manager needs to be configured with the following values to support full airgapped deployments as well as your custom certificates and certificate authority (CA)."}),"\n",(0,t.jsx)(n.h3,{id:"helm-values",children:"Helm Values"}),"\n",(0,t.jsxs)(n.p,{children:["Configure the follow Helm values for your Rancher helm deployment, adjusting the ",(0,t.jsx)(n.code,{children:"rancher-url"})," and ",(0,t.jsx)(n.code,{children:"registry-url"})," for your specific environment."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"additionalTrustedCAs: true\nhostname: <rancher-url>\ningress:\n  tls:\n    source: secret\nrancherImage: <registry-url>/rancher/rancher\nrancherImageTag: v2.10.3-govt-1\nsystemDefaultRegistry: <registry-url>\nuseBundledSystemChart: true\nprivateCA: true\n"})}),"\n",(0,t.jsx)(n.h3,{id:"custom-ca-certificate-secret",children:"Custom CA Certificate Secret"}),"\n",(0,t.jsx)(n.p,{children:"For Rancher to make requests to the Classified AWS endpoints, you need to create a secret containing the AWS CA of your specific environment."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Secret\nmetadata:\n  name: tls-ca-additional\n  namespace: cattle-system\ndata:\n  ca-additional.pem: <encodedPrivateBundle>\ntype: Opaque\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"NOTE"}),": Ensure this secret matches the name and namespace above."]}),"\n",(0,t.jsx)(n.h3,{id:"registry-configuration",children:"Registry Configuration"}),"\n",(0,t.jsxs)(n.p,{children:["You need to configure your Kubernetes cluster to utilize your private registry. Configure the ",(0,t.jsx)(n.code,{children:"registries.yaml"})," file in your RKE2/K3s configuration directories with the following:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'mirrors:\n  "*":\n    endpoint:\n      - "https://<registry-url>"\n\nconfigs:\n  "<registry-url>":\n    auth:\n      username: <redacted>\n      password: <redacted>\n'})}),"\n",(0,t.jsxs)(n.p,{children:["For more information on registry configuration, check out the RKE2 docs ",(0,t.jsx)(n.a,{href:"https://docs.rke2.io/install/containerd_registry_configuration",children:"here"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["For more detailed information about Air-Gapped Rancher, check out the Rancher docs ",(0,t.jsx)(n.a,{href:"https://ranchermanager.docs.rancher.com/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install",children:"here"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},5592:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/RancherGovPortal-360a9c3c17b02b5e0389769019aa93d4.png"},5244:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/modify-iam-role-ab67ad0f57e0821eabcdfb1dea26f78e.png"},8453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>o});var t=r(6540);const s={},a=t.createContext(s);function i(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);