"use strict";(self.webpackChunkcarbide_docs=self.webpackChunkcarbide_docs||[]).push([[178],{6021:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>a,contentTitle:()=>o,default:()=>u,frontMatter:()=>t,metadata:()=>c,toc:()=>d});var n=r(4848),i=r(8453);const t={},o="RKE2/K3s Configuration",c={id:"registry-docs/kubernetes-config",title:"RKE2/K3s Configuration",description:"This page will walk you through how to configure Rancher Kubernetes distributions (K3s, RKE2) to utilize the secured images instead of the upstream Docker hub images.",source:"@site/docs/registry-docs/kubernetes-config.md",sourceDirName:"registry-docs",slug:"/registry-docs/kubernetes-config",permalink:"/carbide-docs/docs/registry-docs/kubernetes-config",draft:!1,unlisted:!1,editUrl:"https://github.com/rancherfederal/carbide-docs/edit/main/docs/registry-docs/kubernetes-config.md",tags:[],version:"current",frontMatter:{},sidebar:"carbideSidebar",previous:{title:"Loading Images to a Registry",permalink:"/carbide-docs/docs/registry-docs/loading-images"},next:{title:"Rancher Manager Configuration",permalink:"/carbide-docs/docs/registry-docs/rancher-config"}},a={},d=[{value:"Usage with <code>k3s</code>",id:"usage-with-k3s",level:3},{value:"Usage with <code>rke2</code>",id:"usage-with-rke2",level:3}];function l(e){const s={a:"a",code:"code",h1:"h1",h3:"h3",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.h1,{id:"rke2k3s-configuration",children:"RKE2/K3s Configuration"}),"\n",(0,n.jsx)(s.p,{children:"This page will walk you through how to configure Rancher Kubernetes distributions (K3s, RKE2) to utilize the secured images instead of the upstream Docker hub images."}),"\n",(0,n.jsxs)(s.h3,{id:"usage-with-k3s",children:["Usage with ",(0,n.jsx)(s.code,{children:"k3s"})]}),"\n",(0,n.jsxs)(s.p,{children:["To modify the system images that ",(0,n.jsx)(s.code,{children:"k3s"})," uses upon bootstrapping, configure k3s' mirror settings as described ",(0,n.jsx)(s.a,{href:"https://rancher.com/docs/k3s/latest/en/installation/private-registry/#mirrors",children:"here"}),"."]}),"\n",(0,n.jsx)(s.p,{children:"The full configuration using your authenticated registry is below:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-yaml",children:'# /etc/rancher/k3s/registries.yaml\nconfigs:\n  "YOUR_REGISTRY_DOMAIN_HERE":\n    auth:\n      username: <redacted>\n      password: <redacted>\n'})}),"\n",(0,n.jsxs)(s.p,{children:["You will also need to utilize the ",(0,n.jsx)(s.code,{children:"system-default-registry"})," flag when installing K3s to ensure it uses the registry. For instance:"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"curl -sfL https://get.k3s.io | sh -s - --system-default-registry=<YOUR_REGISTRY_DOMAIN_HERE>\n"})}),"\n",(0,n.jsxs)(s.h3,{id:"usage-with-rke2",children:["Usage with ",(0,n.jsx)(s.code,{children:"rke2"})]}),"\n",(0,n.jsxs)(s.p,{children:["Similar to ",(0,n.jsx)(s.code,{children:"k3s"}),", the Carbide Secured Registry (CSR) images are pulled upon bootstrapping by configuring ",(0,n.jsx)(s.code,{children:"rke2"}),"'s mirroring configuration as described ",(0,n.jsx)(s.a,{href:"https://rke2.io",children:"here"}),"."]}),"\n",(0,n.jsx)(s.p,{children:"The full configuration using the shared alpha account is below:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-yaml",children:'# /etc/rancher/rke2/registries.yaml\nconfigs:\n  "YOUR_REGISTRY_DOMAIN_HERE":\n    auth:\n      username: <redacted>\n      password: <redacted>\n'})}),"\n",(0,n.jsxs)(s.p,{children:["You will also need to utilize the ",(0,n.jsx)(s.code,{children:"system-default-registry"})," flag when installing RKE2 to ensure it uses the registry. For instance, if using the configuration file:"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"# /etc/rancher/rke2/config.yaml\nnode-name: controlplane1\nwrite-kubeconfig-mode: 0640\nsystem-default-registry: YOUR_REGISTRY_DOMAIN_HERE\n...\n"})})]})}function u(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},8453:(e,s,r)=>{r.d(s,{R:()=>o,x:()=>c});var n=r(6540);const i={},t=n.createContext(i);function o(e){const s=n.useContext(t);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),n.createElement(t.Provider,{value:s},e.children)}}}]);