"use strict";(self.webpackChunkcarbide_docs=self.webpackChunkcarbide_docs||[]).push([[4764],{4706:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>a,toc:()=>l});var n=t(4848),s=t(8453);const i={},o="RKE2/K3s Uninstall",a={id:"registry-docs/uninstall-kubernetes",title:"RKE2/K3s Uninstall",description:"K3s",source:"@site/docs/registry-docs/uninstall-kubernetes.md",sourceDirName:"registry-docs",slug:"/registry-docs/uninstall-kubernetes",permalink:"/carbide-docs/docs/registry-docs/uninstall-kubernetes",draft:!1,unlisted:!1,editUrl:"https://github.com/rancherfederal/carbide-docs/edit/main/docs/registry-docs/uninstall-kubernetes.md",tags:[],version:"current",frontMatter:{},sidebar:"carbideSidebar",previous:{title:"Enforcement",permalink:"/carbide-docs/docs/registry-docs/enforcement"},next:{title:"Rancher Uninstall",permalink:"/carbide-docs/docs/registry-docs/uninstall-rancher"}},c={},l=[{value:"K3s",id:"k3s",level:2},{value:"Reverting to DockerHub Images (Private Registry)",id:"reverting-to-dockerhub-images-private-registry",level:3},{value:"Reverting to DockerHub Images (Directly)",id:"reverting-to-dockerhub-images-directly",level:3},{value:"RKE2",id:"rke2",level:2},{value:"Reverting to DockerHub Images (Private Registry)",id:"reverting-to-dockerhub-images-private-registry-1",level:3},{value:"Reverting to DockerHub Images (Directly)",id:"reverting-to-dockerhub-images-directly-1",level:3}];function d(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.header,{children:(0,n.jsx)(r.h1,{id:"rke2k3s-uninstall",children:"RKE2/K3s Uninstall"})}),"\n",(0,n.jsx)(r.h2,{id:"k3s",children:"K3s"}),"\n",(0,n.jsx)(r.h3,{id:"reverting-to-dockerhub-images-private-registry",children:"Reverting to DockerHub Images (Private Registry)"}),"\n",(0,n.jsxs)(r.p,{children:["If using a private registry, to revert from using the Carbide Secured Images to the normal Rancher images, you simply need to follow the docs to pull the normal images and overwrite them in your registry: ",(0,n.jsx)(r.a,{href:"https://docs.k3s.io/installation/airgap",children:"https://docs.k3s.io/installation/airgap"})]}),"\n",(0,n.jsx)(r.p,{children:"Upon restart of your pods, they should be utilizing the upstream images."}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"NOTE"}),": If you've configured enforcement using Kubewarden or Kyverno, be sure to disable/uninstall to avoid policy enforcement blocking DockerHub images."]}),"\n",(0,n.jsx)(r.h3,{id:"reverting-to-dockerhub-images-directly",children:"Reverting to DockerHub Images (Directly)"}),"\n",(0,n.jsxs)(r.p,{children:["If you want to revert to using images directly from Docker Hub, you'll need to delete the ",(0,n.jsx)(r.code,{children:"registries.yaml"})," configuration file made ",(0,n.jsx)(r.a,{href:"/carbide-docs/docs/registry-docs/configuration/kubernetes#usage-with-k3s",children:"here"}),"."]}),"\n",(0,n.jsxs)(r.p,{children:["You will also need to unset the ",(0,n.jsx)(r.code,{children:"system-default-registry"})," configuration when installing K3s by re-running the ",(0,n.jsx)(r.code,{children:"curl"})," command used to install K3s on each node, with the parameter unset."]}),"\n",(0,n.jsx)(r.p,{children:"For instance, if you originally ran the following when using Carbide images:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:'curl -sfL https://get.k3s.io | INSTALL_K3S_EXEC="server --flannel-backend none" K3S_TOKEN=12345 sh - --system-default-registry <registry-url>\n'})}),"\n",(0,n.jsx)(r.p,{children:"You'd need to run:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:'curl -sfL https://get.k3s.io | INSTALL_K3S_EXEC="server --flannel-backend none" K3S_TOKEN=12345 sh -\n'})}),"\n",(0,n.jsx)(r.h2,{id:"rke2",children:"RKE2"}),"\n",(0,n.jsx)(r.h3,{id:"reverting-to-dockerhub-images-private-registry-1",children:"Reverting to DockerHub Images (Private Registry)"}),"\n",(0,n.jsxs)(r.p,{children:["If using a private registry, to revert from using the Carbide Secured Images to the normal Rancher images, you simply need to follow the docs to pull the normal images and overwrite them in your registry: ",(0,n.jsx)(r.a,{href:"https://docs.rke2.io/install/airgap",children:"https://docs.rke2.io/install/airgap"})]}),"\n",(0,n.jsx)(r.p,{children:"Upon restart of your pods, they should be utilizing the upstream images."}),"\n",(0,n.jsx)(r.h3,{id:"reverting-to-dockerhub-images-directly-1",children:"Reverting to DockerHub Images (Directly)"}),"\n",(0,n.jsxs)(r.p,{children:["If you want to revert to using images directly from Docker Hub, you'll need to delete the ",(0,n.jsx)(r.code,{children:"registries.yaml"})," configuration file made ",(0,n.jsx)(r.a,{href:"/carbide-docs/docs/registry-docs/configuration/kubernetes#usage-with-rke2",children:"here"}),"."]}),"\n",(0,n.jsxs)(r.p,{children:["You'll also need to clean up the ",(0,n.jsx)(r.code,{children:"system-default-registry"})," key/value from your ",(0,n.jsx)(r.code,{children:"/etc/rancher/rke2/config.yaml"})," file on each node, and restart rke2."]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"# /etc/rancher/rke2/config.yaml\nnode-name: controlplane1\nwrite-kubeconfig-mode: 0640\n...\n"})}),"\n",(0,n.jsxs)(r.p,{children:["To restart controlplane nodes, run: ",(0,n.jsx)(r.code,{children:"systemctl restart rke2-server"}),"\nTo restart agents, run: ",(0,n.jsx)(r.code,{children:"systemctl restart rke2-agent"})]}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"NOTE:"})," For controlplane nodes, be sure to restart them one at a time."]})]})}function u(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},8453:(e,r,t)=>{t.d(r,{R:()=>o,x:()=>a});var n=t(6540);const s={},i=n.createContext(s);function o(e){const r=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),n.createElement(i.Provider,{value:r},e.children)}}}]);