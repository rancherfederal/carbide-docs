"use strict";(self.webpackChunkcarbide_docs=self.webpackChunkcarbide_docs||[]).push([[3978],{6642:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>i,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"registry-docs/copying-images","title":"Copying Images to a Registry","description":"The Carbide Secured Registry (CSR) is not intended to be used as the primary registry for running Kubernetes clusters. Instead, follow these steps to copy the images from the CSR to your own registry for later use.","source":"@site/docs/registry-docs/copying-images.md","sourceDirName":"registry-docs","slug":"/registry-docs/copying-images","permalink":"/carbide-docs/docs/registry-docs/copying-images","draft":false,"unlisted":false,"editUrl":"https://github.com/rancherfederal/carbide-docs/edit/main/docs/registry-docs/copying-images.md","tags":[],"version":"current","frontMatter":{},"sidebar":"carbideSidebar","previous":{"title":"Validating Images","permalink":"/carbide-docs/docs/registry-docs/validating-images"},"next":{"title":"Downloading the Images","permalink":"/carbide-docs/docs/registry-docs/downloading-images"}}');var a=s(4848),t=s(8453);const c={},o="Copying Images to a Registry",i={},d=[{value:"Copying Secured Images",id:"copying-secured-images",level:2},{value:"Carbide",id:"carbide",level:3},{value:"Rancher",id:"rancher",level:3},{value:"Cert Manager",id:"cert-manager",level:3},{value:"RKE2",id:"rke2",level:3},{value:"K3s",id:"k3s",level:3},{value:"Harvester",id:"harvester",level:3},{value:"Longhorn",id:"longhorn",level:3},{value:"NeuVector",id:"neuvector",level:3},{value:"Kubewarden",id:"kubewarden",level:3},{value:"Application Collection",id:"application-collection",level:3}];function l(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.header,{children:(0,a.jsx)(r.h1,{id:"copying-images-to-a-registry",children:"Copying Images to a Registry"})}),"\n",(0,a.jsx)(r.p,{children:"The Carbide Secured Registry (CSR) is not intended to be used as the primary registry for running Kubernetes clusters. Instead, follow these steps to copy the images from the CSR to your own registry for later use."}),"\n",(0,a.jsxs)(r.p,{children:["These instructions are for connected environments. If you're copying images into an airgapped registry, check the documentation ",(0,a.jsx)(r.a,{href:"/carbide-docs/docs/registry-docs/downloading-images",children:"here"}),"."]}),"\n",(0,a.jsxs)(r.p,{children:["This example uses ",(0,a.jsx)(r.a,{href:"https://docs.hauler.dev/docs/intro",children:"Hauler"}),", but any tool with the ability to push/pull an OCI image will be adequate."]}),"\n",(0,a.jsx)(r.h2,{id:"copying-secured-images",children:"Copying Secured Images"}),"\n",(0,a.jsxs)(r.p,{children:["The following steps are for pulling the multi-arch images. Please see the ",(0,a.jsx)(r.a,{href:"https://rancherfederal.github.io/hauler-docs/docs/guides-references/hauler-content/images",children:"Hauler Docs"})," for how to specify a specific platform."]}),"\n",(0,a.jsxs)(r.p,{children:["If using the ",(0,a.jsx)(r.code,{children:"hauler store sync"})," command from the Carbide portal, you may now select your platform in the UI and the ",(0,a.jsx)(r.code,{children:"--platform"})," flag will be added to the command for you. If you wish to pull the multi-arch images instead, remove ",(0,a.jsx)(r.code,{children:"--platform"})," from the command."]}),"\n",(0,a.jsx)(r.h3,{id:"carbide",children:"Carbide"}),"\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.strong,{children:"1. Generate the Hauler manifest for Carbide."})}),"\n",(0,a.jsx)(r.p,{children:"The Hauler manifest is a yaml file which specifies the artifacts to fetch."}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"cat <<EOF > carbide-images.yaml\napiVersion: content.hauler.cattle.io/v1\nkind: Images\nmetadata:\n  name: carbide-images\nspec:\n  images:\n$(curl -sfL https://raw.githubusercontent.com/rancherfederal/carbide-releases/main/carbide-images.txt | sed '/nats/d' | sed 's/^/    - name: /')\n---\napiVersion: content.hauler.cattle.io/v1\nkind: Images\nmetadata:\n  name: carbide-dependency-images\nspec:\n  images:\n$(curl -sfL https://raw.githubusercontent.com/rancherfederal/carbide-releases/main/carbide-images.txt | sed '/rgcr/d' | sed 's/^/    - name: /')\nEOF\n"})}),"\n",(0,a.jsxs)(r.p,{children:["You can optionally set metadata such as platform specs and public keys in the manifest instead of through command line flags (not shown in this example). For more information on this, check out the ",(0,a.jsx)(r.a,{href:"https://docs.hauler.dev/docs/guides-references/hauler-manifests",children:"Hauler Manifests"})," guide."]}),"\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.strong,{children:"2. Fetch the content from the Hauler manifest."})}),"\n",(0,a.jsxs)(r.p,{children:["The ",(0,a.jsx)(r.code,{children:"hauler store sync"})," command syncs the content specified in the manifest with the Hauler store, which can then be copied to your registry."]}),"\n",(0,a.jsxs)(r.p,{children:["Setting ",(0,a.jsx)(r.code,{children:"--store"})," allows you to specify the Hauler store, in this case, ",(0,a.jsx)(r.code,{children:"carbide-store"}),". You may also specify the desired platform at this step with ",(0,a.jsx)(r.code,{children:"--platform"}),"."]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"hauler store sync --store carbide-store --files carbide-images.yaml --platform <platform/arch> --key carbide-key.pub\n"})}),"\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.strong,{children:"3. Copy the content from the Hauler store to your registry."})}),"\n",(0,a.jsx)(r.p,{children:"Hauler will copy the stored artifacts to your registry. Specify the username and password to your registry, followed by the URL."}),"\n",(0,a.jsx)(r.p,{children:"If you named your store in the previous step, specify which store you'd like to copy."}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"hauler store copy --store carbide-store --username <redacted> --password <redacted> registry://<registry-url>\n"})}),"\n",(0,a.jsx)(r.h3,{id:"rancher",children:"Rancher"}),"\n",(0,a.jsxs)(r.p,{children:["Carbide customers can also fetch ",(0,a.jsx)(r.code,{children:"collections"})," from the CSR, which will pull all the required artifacts for a product into the Hauler store."]}),"\n",(0,a.jsx)(r.p,{children:"Installing Rancher requires Cert Manager, which can be pulled from the CSR as well."}),"\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.strong,{children:"1. Log in to the Carbide Secured Registry."})}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"hauler login -u <username> -p <password> rgcrprod.azurecr.us\n"})}),"\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.strong,{children:"2. Sync Rancher to your Hauler store."})}),"\n",(0,a.jsxs)(r.p,{children:["Specify the  ",(0,a.jsx)(r.code,{children:"--products"})," flag with your desired version."]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"hauler store sync --store rancher-store --products rancher=v2.8.3 --key carbide-key.pub --platform <platform/arch>\n"})}),"\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.strong,{children:"3. Copy the content from the Hauler store to your registry."})}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"hauler store copy --store rancher-store --username <redacted> --password <redacted> registry://<registry-url>\n"})}),"\n",(0,a.jsx)(r.h3,{id:"cert-manager",children:"Cert Manager"}),"\n",(0,a.jsx)(r.p,{children:"Sync content:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"hauler store sync --store certmanager-store --products cert-manager=v1.14.4 --key carbide-key.pub --platform <platform/arch>\n"})}),"\n",(0,a.jsx)(r.p,{children:"Copy to registry:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"hauler store copy --store certmanager-store --username <redacted> --password <redacted> registry://<registry-url>\n"})}),"\n",(0,a.jsx)(r.h3,{id:"rke2",children:"RKE2"}),"\n",(0,a.jsx)(r.p,{children:"Sync content:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"hauler store sync --store rke2-store --products rke2=v1.27.12+rke2r1 --key carbide-key.pub --platform <platform/arch>\n"})}),"\n",(0,a.jsx)(r.p,{children:"Copy to registry:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"hauler store copy --store rke2-store --username <redacted> --password <redacted> registry://<registry-url>\n"})}),"\n",(0,a.jsx)(r.h3,{id:"k3s",children:"K3s"}),"\n",(0,a.jsx)(r.p,{children:"Sync content:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"hauler store sync --store k3s-store --products k3s=v1.27.12-k3s1 --key carbide-key.pub --platform <platform/arch>\n"})}),"\n",(0,a.jsx)(r.p,{children:"Copy to registry:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"hauler store copy --store k3s-store --username <redacted> --password <redacted> registry://<registry-url>\n"})}),"\n",(0,a.jsx)(r.h3,{id:"harvester",children:"Harvester"}),"\n",(0,a.jsx)(r.p,{children:"Sync content:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"hauler store sync --store harvester-store --products harvester=v1.4.1 --key carbide-key.pub --platform <platform/arch>\n"})}),"\n",(0,a.jsx)(r.p,{children:"Copy to registry:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"hauler store copy --store harvester-store --username <redacted> --password <redacted> registry://<registry-url>\n"})}),"\n",(0,a.jsx)(r.h3,{id:"longhorn",children:"Longhorn"}),"\n",(0,a.jsx)(r.p,{children:"Sync content:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"hauler store sync --store longhorn-store --products longhorn=v1.6.1 --key carbide-key.pub --platform <platform/arch>\n"})}),"\n",(0,a.jsx)(r.p,{children:"Copy to registry:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"hauler store copy --store longhorn-store --username <redacted> --password <redacted> registry://<registry-url>\n"})}),"\n",(0,a.jsx)(r.h3,{id:"neuvector",children:"NeuVector"}),"\n",(0,a.jsx)(r.p,{children:"Sync content:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"hauler store sync --store neuvector-store --products neuvector=v5.3.2 --key carbide-key.pub --platform <platform/arch>\n"})}),"\n",(0,a.jsx)(r.p,{children:"Copy to registry:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"hauler store copy --store neuvector-store --username <redacted> --password <redacted> registry://<registry-url>\n"})}),"\n",(0,a.jsx)(r.h3,{id:"kubewarden",children:"Kubewarden"}),"\n",(0,a.jsx)(r.p,{children:"Sync content:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"hauler store sync --store kubewarden-store --products kubewarden=kubewarden-controller-2.0.11 --key carbide-key.pub --platform <platform/arch>\n"})}),"\n",(0,a.jsx)(r.p,{children:"Copy to registry:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"hauler store copy --store kubewarden-store --username <redacted> --password <redacted> registry://<registry-url>\n"})}),"\n",(0,a.jsx)(r.h3,{id:"application-collection",children:"Application Collection"}),"\n",(0,a.jsx)(r.p,{children:"Sync app:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"hauler store sync --store application-store --products apps-<application-name>=0.28.1 --key carbide-key.pub --platform <platform/arch>\n"})}),"\n",(0,a.jsx)(r.p,{children:"Copy to registry:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"hauler store copy --store application-store --username <redacted> --password <redacted> registry://<registry-url>\n"})})]})}function h(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,a.jsx)(r,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},8453:(e,r,s)=>{s.d(r,{R:()=>c,x:()=>o});var n=s(6540);const a={},t=n.createContext(a);function c(e){const r=n.useContext(t);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:c(e.components),n.createElement(t.Provider,{value:r},e.children)}}}]);